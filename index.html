<html>
  <head>
    <title>Sunday</title>
    <script src="https://unpkg.com/stein-js-client"></script>
    <style>
      table, tr, td {
        border: 1px solid;
        border-color: lightgray;
      }
    </style>
  </head>
  <body>
  <!--  <div id="acpSignal" style="font-size: 40px;"></div> -->
    <div id="acpBlurb1"></div>
    <div id="acpTable"></div>
    <div id="acpBlurb2"></div>
  <hr/>
    <div id="acpTable2"></div>


    <script>

function ddmmyyyyToYyyymmdd(dateStr) {
  const [dd, mm, yyyy] = dateStr.split('/');
  return `${yyyy}${mm}${dd}`;
}

console.log(ddmmyyyyToYyyymmdd("31/12/2025")); // "20251231"
  
   function parseDateDDMMYYYY(dateStr) {
  const parts = dateStr.split('/');
  // parts[0] = day, parts[1] = month, parts[2] = year
  return new Date(parseInt(parts[2], 10), parseInt(parts[1], 10) - 1, parseInt(parts[0], 10));
}

  function addDays(date, days) {
  const result = new Date(date);       // Clone the original date to avoid mutation
  result.setDate(result.getDate() + days);  // Add the number of days
  return result;
}

async function main() {
  const theYear = "2025";

      //const result = await getData();
      
  const thisDate = new Date();
  const nextMonth = new Date(thisDate.getFullYear(), thisDate.getMonth() + 1, 1);
const monthNameFrench = nextMonth.toLocaleString('fr-FR', { month: 'long' });
    
      const store = new SteinStore(
        "https://api.steinhq.com/v1/storages/691edb78affba40a621cdb9c"
      );

      store.read("Ride Plan "+theYear)
        .then(data => {
          
    for (const row of data) {
  if (row.Date == null) break;
 //             console.log(parseDateDDMMYYYY(row.Date));
              if (parseDateDDMMYYYY(row.Date) > thisDate) {
                const hour = row.HeuredeDepart.substring(0,2)+"h"+row.HeuredeDepart.substring(3,5)
       //       document.getElementById("acpSignal").innerHTML =
        //        `Demain, pour le G1, d√©part de ${row.PointdeDepart} √† ${hour}. D√©tails ici : ???<br/><hr>`;
        
                break;
              } //if (parseDateDDMMYYYY(row.Date)) > thisDate
          } //for (const row of data)

          for (const row of data) {
  if (row.Date == null) break;
 //             console.log(parseDateDDMMYYYY(row.Date));
      let theDate2 = parseDateDDMMYYYY(row.Date).getDate();
            let imageFilename = '/Sunday/images/'+ddmmyyyyToYyyymmdd(row.Date)+'.png';
      let thisMonth = new Date(thisDate.getFullYear(), thisDate.getMonth(), 1);
const monthNameFrench2 = thisMonth.toLocaleString('fr-FR', { month: 'long' });
              if (parseDateDDMMYYYY(row.Date) > thisDate) {
                const hour = row.HeuredeDepart.substring(0,2)+"h"+row.HeuredeDepart.substring(3,5);
                const url = 'https://chr1sg1thub.github.io/TownsOnMap/?gpxFile='+row.Parcours+'.gpx&clat='+row.PCLat+'&clon='+row.PCLon+'&dist='+row.Distance+'&deniv='+row.Denivele;
              document.getElementById("acpBlurb1").innerHTML =
                `<p style="font-family: Verdana, Geneva, sans-serif; font-size: 24px">Sortie du dimanche ${theDate2} ${monthNameFrench2} ${theYear}</p><div style="font-family: Verdana, Geneva, sans-serif; font-size: 16px">
                 <img src = "ACP Logo.png" width=142px>&nbsp;Bonjour √† toutes et tous,<br/><br/>
                 <span style="color: red"><strong>G1 et G2¬†rdv √† ${row.PointdeDepart} √† ${hour}.</strong></span>
                 <p>Le rendez-vous pour les sorties organis√©es par¬†le¬†club sont diffus√©es sur le blog et/ou Signal.
                 Si le lieu du¬†d√©part est modifi√© vous serez inform√©s via la messagerie du club.</p>

                 <p>Apr√®s la pause-caf√©, deux groupes pourront √™tre constitu√©s en fonction des participants et de leur niveau de forme.</p>
                 <p style="color: red"><strong>Parcours propos√© pour le G1 :</strong></p></div>`;
        
              document.getElementById("acpTable").innerHTML =
                `<div style="font-family: Verdana, Geneva, sans-serif;">
                   <table width=100%>
                     <tr><td colspan=2 align=center><a href='${url}' target=_blank><img src='${imageFilename}' width=90%><a><br>üëÄ&nbsp;<i>Pour une version zoomable, avec les Points d'Eau pr√®s de la route (<img src='fountain.png' width=22px>&nbsp;<img src='tap.png' width=22px>&nbsp;<img src='toilets.png' width=22px>&nbsp;<img src='water.png' width=22px>), cliquez sur la carte ou <a href='${url}' target=_blank style='font-size: 24px; background-color: yellow;'>ici</a>.</i>&nbsp;üëÄ<br/></td></tr>
                     <tr><td><strong>Parcours</strong></td><td>${row.Parcours}</td></tr>
                     <tr><td><strong>Parcours D√©taill√©</strong></td><td style="font-size: 10px;">${row.Details}</td></tr>
                     <tr><td><strong>Dist (km)</strong></td><td>${row.Distance}</td></tr>
                     <tr><td><strong>D√©niv (m)</strong></td><td>${row.Denivele}</td></tr>
                     <tr><td><strong>Caf√©</strong></td><td>${row.PauseCaf√©}</td></tr>
                     <tr><td><strong>Itin√©raire</strong></td><td><a href="${row.Strava}" target="_blank">Itin√©raire</a></td></tr>
                     <tr><td><strong>Trace (GPX)</strong></td><td><a href="xxx">Trace</a></td></tr>
                   </table>
                 </div>`;
       
              document.getElementById("acpBlurb2").innerHTML =
                `<div style="font-family: Verdana, Geneva, sans-serif; font-size: 16px">
                   <p style="color: red"><strong>Parcours propos√© pour le G2</strong></p>
                   <p>(Voir Signal si pas de publication ici ‚Ä¶)</p>
                 </div>`;
                break;
              } //if (parseDateDDMMYYYY(row.Date)) > thisDate
          } //for (const row of data)
 
             let monthHTML = '<p style="font-family: Verdana, Geneva, sans-serif; font-size: 24px">Sorties (G1) programm√©es de '+monthNameFrench+' '+theYear+'</p><p style="font-family: Verdana, Geneva, sans-serif; font-size: 16px">Voici les sorties dominicales (G1) programm√©es pour le mois de '+monthNameFrench+'¬†:</p>'+'<div style="font-family: Verdana, Geneva, sans-serif;"><table style="border-collapse: collapse;"><tr><td><strong>Date</strong></td><td><strong>D√©part</strong></td><td><strong>Heure</strong></td><td><strong>Parcours</strong></td><td><strong>Pause Caf√©</strong></td><td><strong>Dist (km)</strong></td><td><strong>D√©niv (m)</strong></td></tr>';
let dayAndMonth;
          let thisMonth;
          let monthNameFrenchShort;

          for (const row of data) {
  if (row.Date == null) break;
                            url = 'https://chr1sg1thub.github.io/TownsOnMap/?gpxFile='+row.Parcours+'.gpx&clat='+row.PCLat+'&clon='+row.PCLon+'&dist='+row.Distance+'&deniv='+row.Denivele;

 //             console.log(parseDateDDMMYYYY(row.Date));
              if (parseDateDDMMYYYY(row.Date).getMonth() == thisDate.getMonth() + 1) {
                            thisMonth = new Date(parseDateDDMMYYYY(row.Date).getFullYear(), parseDateDDMMYYYY(row.Date).getMonth(), 1);
const monthNameFrenchShort = thisMonth.toLocaleString('fr-FR', { month: 'short' });

        dayAndMonth = parseDateDDMMYYYY(row.Date).getDate() + ' ' + monthNameFrenchShort;
                      const hour = row.HeuredeDepart.substring(0,2)+"h"+row.HeuredeDepart.substring(3,5);
        monthHTML +=
                `<tr><td>${dayAndMonth}</td><td>${row.PointdeDepart}</td><td>${hour}</td><td><a href='${url}' target="_blank">${row.Parcours}</a></td><td>${row.PauseCaf√©}</td><td>${row.Distance}</td><td>${row.Denivele}</td></tr>`;
                
              } //if (parseDateDDMMYYYY(row.Date).getMonth() > thisDate.getMonth() + 1)
          } //for (const row of data)
          monthHTML += '</table></div>';
          document.getElementById("acpTable2").innerHTML = monthHTML;

        } //data =>
      ); //.then
} //main()
      main();

    </script>
  </body>
</html>
