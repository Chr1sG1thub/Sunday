<html>
  <head>
    <script src="https://unpkg.com/stein-js-client"></script>
    <style>
      table, tr, td {
        border: 1px solid;
        border-color: lightgray;
      }
    </style>
  </head>
  <body>
    <div id="acpBlurb1"></div>
    <div id="acpTable"></div>
    <div id="acpBlurb2"></div>
  
    <div id="acpTable2"></div>

    <script>

function parseDateDDMMYYYY(dateStr) {
  const parts = dateStr.split('/');
  // parts[0] = day, parts[1] = month, parts[2] = year
  return new Date(parseInt(parts[2], 10), parseInt(parts[1], 10) - 1, parseInt(parts[0], 10));
}

  function addDays(date, days) {
  const result = new Date(date);       // Clone the original date to avoid mutation
  result.setDate(result.getDate() + days);  // Add the number of days
  return result;
}

      const thisDate = new Date();
      
      const store = new SteinStore(
        "https://api.steinhq.com/v1/storages/690356b8affba40a62129a2d"
      );

      store.read("Ride Plan 2025")
        .then(data => {
          
    for (const row of data) {
  if (row.Date == null) break;
 //             console.log(parseDateDDMMYYYY(row.Date));
              if (parseDateDDMMYYYY(row.Date) > thisDate) {
              document.getElementById("acpBlurb1").innerHTML =
                `<div style="font-family: Verdana, Geneva, sans-serif; font-size: 16px">
                 <img src = "ACP Logo.png" width=142px>&nbsp;Bonjour à toutes et tous,<br/><br/>
                 <span style="color: red"><strong>G1 et G2 rdv à ${row.PointdeDepart} à ${row.HeuredeDepart}.</strong></span>
                 <p>Le rendez-vous pour les sorties organisées par le club sont diffusées sur le blog et/ou Signal.
                 Si le lieu du départ est modifié vous serez informés via la messagerie du club.</p>

                 <p>Après la pause-café, deux groupes pourront être constitués en fonction des participants et de leur niveau de forme.</p>
                 <p style="color: red"><strong>Parcours proposé pour le G1 :</strong></p></div>`;
        
              document.getElementById("acpTable").innerHTML =
                `<div style="font-family: Verdana, Geneva, sans-serif;">
                   <table>
                     <tr><td colspan=2 align=center>x</td></tr>
                     <tr><td><strong>Parcours</strong></td><td>${row.Parcours}</td></tr>
                     <tr><td><strong>Dist (km)</strong></td><td>${row.Distance}</td></tr>
                     <tr><td><strong>Déniv (m)</strong></td><td>${row.Denivele}</td></tr>
                     <tr><td><strong>Café</strong></td><td>${row.PauseCafé}</td></tr>
                     <tr><td><strong>Itinéraire</strong></td><td>x</td></tr>
                     <tr><td><strong>Trace (GPX)</strong></td><td>x</td></tr>
                   </table>
                 </div>`;
       
              document.getElementById("acpBlurb2").innerHTML =
                `<div style="font-family: Verdana, Geneva, sans-serif; font-size: 16px">
                   <p style="color: red"><strong>Parcours proposé pour le G2</strong></p>
                   <p>(Voir Signal si pas de publication ici …)</p>
                 </div>`;
                break;
              } //if (parseDateDDMMYYYY(row.Date)) > thisDate
          } //for (const row of data)
 
             let monthHTML = '<div style="font-family: Verdana, Geneva, sans-serif;"><table><tr><strong><td>Date</td><td>Départ</td><td>Heure</td><td>Départ</td><td>Parcours</td><td>Dist.</td><td>Deniv.</td></strong></tr>';

          for (const row of data) {
  if (row.Date == null) break;
 //             console.log(parseDateDDMMYYYY(row.Date));
              if (parseDateDDMMYYYY(row.Date).getMonth() == thisDate.getMonth() + 1) {
        
              monthHTML +=
                `<tr><td>Date</td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td></tr>`;
                
              } //if (parseDateDDMMYYYY(row.Date).getMonth() > thisDate.getMonth() + 1)
          } //for (const row of data)
          monthHTML += '</table></div>';
          document.getElementById("acpTable2").innerHTML = monthHTML;

        } //data =>
      ); //.then

    </script>
  </body>
</html>
